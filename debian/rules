#!/usr/bin/make -f

SOURCE_NAME    := xserver-xorg-video-intel
SOURCE_VERSION := $(shell dpkg-parsechangelog | awk -F': ' '/^Version: / {print $$2}')
BUILDER        := $(shell dpkg-parsechangelog | awk -F': ' '/^Maintainer: / {print $$2}')

# Borrowed from the server (see 72ca1fdf2f for reference):
override_dh_auto_configure:
	dh_auto_configure -- --with-builderstring="$(SOURCE_NAME) $(SOURCE_VERSION) ($(BUILDER))"

# Install in debian/tmp to retain control through dh_install:
override_dh_auto_install:
	dh_auto_install --destdir=debian/tmp

# Kill *.la files, libxvmc symlinks, and forget no-one:
override_dh_install:
	find debian/tmp -name '*.la' -delete
	rm -f debian/tmp/usr/lib/libI810XvMC.so
	rm -f debian/tmp/usr/lib/libIntelXvMC.so
	dh_install --fail-missing

# Debug package:
override_dh_strip:
	dh_strip --dbg-package=xserver-xorg-video-intel-dbg

# That's a plugin, use appropriate warning level:
override_dh_shlibdeps:
	dh_shlibdeps -- --warnings=6

%:
	dh $@ --with quilt,autoreconf,xsf --builddirectory=build/
